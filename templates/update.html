<!DOCTYPE html>
<html>

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Site Metas -->
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="author" content="" />

  <title>Maverick</title>

  <!-- slider stylesheet -->
  <!-- slider stylesheet -->
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />

  <!-- bootstrap core css -->
  <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.css') }}" />

  <!-- fonts style -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet" />
  <!-- Custom styles for this template -->
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
  <!-- responsive style -->
  <link href="{{ url_for('static', filename='css/responsive.css') }}" rel="stylesheet" />
</head>

<body>
  <div class="hero_area">
    <!-- header section strats -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="/">
            <span>
              Maverick
            </span>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="d-flex ml-auto flex-column flex-lg-row align-items-center">
              <ul class="navbar-nav  ">
                <li class="nav-item ">
                  <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/about"> About </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/info"> Info </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/hire"> Hire </a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="/update"> Update </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/fire"> Fire </a>
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- end header section -->
  </div>

<!-- hire section -->
<section class="hire_section layout_padding">
    <div class="heading_container">
      <h2>
        Update Employee Information
      </h2>
    </div>
    <form>
      <div class="form-group">
        <input class="form-control" type="text" name="emp_id" id="emp_id" placeholder="Enter Employee ID" style="width: 800px; margin: 20px auto;">
        <button type="button" class="button_design" id="search-btn">Search</button>
      </div>
    
      <div id="employee-details" style="display: none;">
        <div class="form-group">
          <input class="form-control" type="text" name="fname" id="fname" placeholder="full name" style="width: 800px; margin: 20px auto;">
        </div>
        <div class="form-group">
          <input class="form-control" type="text" name="ic" id="ic" placeholder="IC No." style="width: 800px; margin: 20px auto;">
        </div>
        <div class="form-group">
          <input class="form-control" type="text" name="email" id="email" placeholder="Email" style="width: 800px; margin: 20px auto;">
        </div>
        <div class="form-group">
          <input class="form-control" type="text" name="location" id="location" placeholder="Location" style="width: 800px; margin: 20px auto;">
        </div>
        <div class="form-group">
          <input class="form-control" type="text" name="payscale" id="payscale" placeholder="Pay Scale(RM)" style="width: 800px; margin: 20px auto;">
        </div>
        <div class="form-group">
          <input class="form-control" type="file" name="emp_image_file" id="emp_image_file" placeholder="Image" style="width: 800px; margin: 20px auto;">
        </div>
        <button type="button" class="button_design" id="save-btn">Save</button>
      </div>
    
      <div id="error-message" class="alert alert-danger" role="alert" style="display: none; width: 800px; margin: 20px auto;">
        Employee not found.
      </div>
    </form>
  </section>
  <!-- end hire section -->

  <!-- info section -->
  <section class="info_section layout_padding">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <div class="info_contact">
            <div class="info_logo">
              <a href="index.html">
                <span>
                  Maverick
                </span>
              </a>
            </div>
            <h5>
              Contact Us
            </h5>
            <div>
              <div class="img-box">
                <img src="{{ url_for('static', filename='images/location.png') }}" width="18px" alt="Image" />
              </div>
              <p>
                Page when looking at its layou
              </p>
            </div>
            <div>
              <div class="img-box">
                <img src="{{ url_for('static', filename='images/phone.png') }}" width="18px" alt="Image" />
              </div>
              <p>
                +01 1234567890
              </p>
            </div>
            <div>
              <div class="img-box">
                <img src="{{ url_for('static', filename='images/envelope.png') }}" width="18px" alt="" />
              </div>
              <p>
                demo@gmail.com
              </p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="info_info">
            <h5>
              Invest Money
            </h5>
            <p>
              There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration
              in some form, by injected humour,
            </p>
          </div>
        </div>

        <div class="col-md-3">
          <div class="info_links">
            <h5>
              Useful Links
            </h5>
            <ul>
              <li>
                <a href="">
                  There are many
                </a>
              </li>
              <li>
                <a href="">
                  variations of
                </a>
              </li>
              <li>
                <a href="">
                  passages of
                </a>
              </li>
              <li>
                <a href="">
                  Lorem Ipsum
                </a>
              </li>
              <li>
                <a href="">
                  available, but the
                </a>
              </li>
              <li>
                <a href="">
                  majority have
                </a>
              </li>
              <li>
                <a href="">
                  suffered
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-3">
          <div class="info_form ">
            <h5>
              Newsletter
            </h5>
            <form action="">
              <input type="email" placeholder="Enter your email" />
              <button>
                Subscribe
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- end info_section -->

  <!-- footer section -->
  <section class="container-fluid footer_section">
    <p>
      &copy; 2019 All Rights Reserved By
      <a href="https://html.design/">Free Html Templates</a>
    </p>
  </section>
  <!-- footer section -->

  <script type="text/javascript" src="{{ url_for('static', filename='js/jquery-3.4.1.min.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.js') }}"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  </script>
  <!-- owl carousel script 
    -->
  <script type="text/javascript">
    $(".owl-carousel").owlCarousel({
      loop: true,
      margin: 0,
      navText: [],
      center: true,
      autoplay: true,
      autoplayHoverPause: true,
      responsive: {
        0: {
          items: 1
        },
        1000: {
          items: 3
        }
      }
    });
  </script>
  <!-- end owl carousel script -->
  <script>
    function validateForm() {
      var emp_id = document.getElementById("emp_id").value;
      if (emp_id.length != 4 || isNaN(emp_id)) {
        alert("Employee ID must be a 4-digit number.");
        return false;
      }
      return true;
    }
  
  document.getElementById("search-btn").addEventListener("click", function() {
  var empId = document.getElementById("emp_id").value;
  
  fetch("/searchEmp", {
  method: "POST",
  body: JSON.stringify({ emp_id: empId }),
  headers: {
    "Content-Type": "application/json"
  }
})
.then(function(response) {
  return response.json();
})
.then(function(data) {
  if (data.error) {
    document.getElementById("employee-details").style.display = "none";
    document.getElementById("error-message").style.display = "block";
    document.getElementById("save-btn").style.display = "none";
    console.log(data.error);
  } else {
    document.getElementById("employee-details").style.display = "block";
    document.getElementById("error-message").style.display = "none";
    document.getElementById("save-btn").style.display = "block";

    document.getElementById("fname").value = data.fname;
    document.getElementById("ic").value = data.ic;
    document.getElementById("email").value = data.email;
    document.getElementById("location").value = data.location;
    document.getElementById("payscale").value = data.payscale;

    document.getElementById("emp_image_file").value = ""; // Clear the file input value

    // Set the image file to the "emp_image_file" input
    if (data.image_path) {
      fetch(data.image_path)
        .then(function(response) {
          return response.blob();
        })
        .then(function(blob) {
          var file = new File([blob], "emp-id-" + data.emp_id + "_image_file.jpg");
          var filesList = new DataTransfer();
          filesList.items.add(file);
          document.getElementById("emp_image_file").files = filesList.files;
        })
        .catch(function(error) {
          console.log("Error loading image:", error);
        });
      }
    }
  })
  .catch(function(error) {
    console.log(error);
  });
});

    document.getElementById("save-btn").addEventListener("click", function() {
      var empId = document.getElementById("emp_id").value;
      var fname = document.getElementById("fname").value;
      var ic = document.getElementById("ic").value;
      var email = document.getElementById("email").value;
      var location = document.getElementById("location").value;
      var payscale = document.getElementById("payscale").value;
      var imageFile = document.getElementById("emp_image_file").files[0]; // Get the selected file

      var formData = new FormData();
      formData.append('emp_id', empId);
      formData.append('fname', fname);
      formData.append('ic', ic);
      formData.append('email', email);
      formData.append('location', location);
      formData.append('payscale', payscale);
      formData.append('emp_image_file', imageFile);

      fetch("/updateEmp", {
        method: "POST",
        body: formData,
      })
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        if (data.status === "success") {
          alert("Employee data saved successfully!");
          document.getElementById("employee-details").style.display = "none";
          document.getElementById("save-btn").style.display = "none";
          document.getElementById("emp_id").value = "";
          function scrollToTop() {
            window.scrollTo({
            top: 0,
            behavior: 'smooth' // Optional: Smooth scrolling animation
            });
          }
          location.reload();
        } else {
          alert("Error saving employee data");
        }
      })
      .catch(function(error) {
        console.log(error);
      });
    });
  </script>
</body>

</html>